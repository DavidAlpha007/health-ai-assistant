# 极简接口定义文档

## 一、通用接口规范

### 1. 接口基础信息
- 协议：HTTP/HTTPS
- 请求方式：POST
- 数据格式：JSON
- 字符编码：UTF-8

### 2. 通用响应格式
```json
{
  "code": 0,
  "message": "success",
  "data": {}
}
```

### 3. 错误码定义
| 错误码 | 错误描述 |
|-------|---------|
| 0 | 成功 |
| 10001 | 无效请求参数 |
| 10002 | 手机号格式错误 |
| 10003 | 验证码错误或已过期 |
| 10004 | 登录态无效 |
| 10005 | 服务器内部错误 |
| 10006 | 接口调用频率过高 |

## 二、核心接口定义

### 1. 登录/验证码接口
#### 1.1 获取验证码
- 接口路径：`/api/v1/auth/send-code`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "phone": "13800138000" // 手机号（11位数字）
  }
  ```
- 响应示例：
  ```json
  {
    "code": 0,
    "message": "success",
    "data": {
      "send_time": 1640995200000 // 验证码发送时间戳
    }
  }
  ```

#### 1.2 登录验证
- 接口路径：`/api/v1/auth/login`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "phone": "13800138000", // 手机号（11位数字）
    "code": "123456" // 验证码（6位数字）
  }
  ```
- 响应示例：
  ```json
  {
    "code": 0,
    "message": "success",
    "data": {
      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...", // 登录态token（有效期24小时）
      "user_id": "user_123456" // 用户唯一标识
    }
  }
  ```

### 2. 埋点数据上报接口
- 接口路径：`/api/v1/analytics/report`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "event_id": "MVP_Login_Enter", // 埋点ID
    "timestamp": 1640995200000 // 事件触发时间戳（毫秒）
  }
  ```
- 响应示例：
  ```json
  {
    "code": 0,
    "message": "success",
    "data": {}
  }
  ```

### 3. 打卡激活状态更新接口
- 接口路径：`/api/v1/user/activate`
- 请求方法：POST
- 请求头：
  - `Authorization: Bearer {token}` // 登录态token
- 请求参数：
  ```json
  {
    "user_id": "user_123456" // 用户唯一标识
  }
  ```
- 响应示例：
  ```json
  {
    "code": 0,
    "message": "success",
    "data": {
      "activated": true, // 激活状态
      "activate_time": 1640995200000 // 激活时间戳
    }
  }
  ```

## 三、接口调用说明

1. **登录流程**：
   - 用户输入手机号，调用获取验证码接口
   - 用户输入验证码，调用登录验证接口
   - 登录成功后，前端保存token用于后续接口调用

2. **埋点上报**：
   - 事件触发时，直接调用埋点上报接口
   - 无需携带登录态

3. **打卡激活**：
   - 用户完成方案后，调用打卡激活接口
   - 需携带有效登录态token

## 四、接口安全规范

1. **验证码频率限制**：同一手机号5分钟内最多获取3次验证码
2. **登录频率限制**：同一IP5分钟内最多调用10次登录接口
3. **Token有效期**：24小时，过期后需重新登录
4. **数据加密**：敏感数据传输需使用HTTPS

## 五、部署信息

- 测试环境地址：`http://test-api.health-ai.com`
- 正式环境地址：`https://api.health-ai.com`
- 接口版本：v1

## 六、变更记录

| 版本 | 变更日期 | 变更内容 | 变更人 |
|-----|---------|---------|-------|
| v1.0 | 2024-01-13 | 初始版本，定义3个核心接口 | 产品团队 |